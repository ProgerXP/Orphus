/*! Orphus.js | by Dmitry Koterov & Proger_XP | orphus.ru | proger.me */
!function(){"use strict";var e=window.orphus||{},d=window.orphus={};d.opt={version:"6.0",email:"",homepage:"https://github.com/ProgerXP/Orphus",c_tag1:"<!!!>",c_tag2:"<!!!>",contextLength:60,maxSelection:256,action:"/orphus.php",maxWidth:650,strings:{alt:"Select the fragment with a typo using your mouse and press Ctrl+Enter.",badbrowser:"Your browser doesn't support selection or IFRAME. Perhaps it's too old, or perhaps there's some other error.",toobig:"Your selection is too long. Please select a smaller fragment.",subject:"Orphus Report",intextmsg:"A mistake or typo in this text:",ifsendmsg:"Send a message to the authors? You will stay on this page.",gohome:"Or perhaps you want to visit the Orphus' homepage (in a new tab)?",name:"Orphus",author:"by Dmitry Koterov & Proger_XP",to:"Proger_XP",send:"Submit",cancel:"Cancel",entercmnt:"Your comment (optional):",submitex:"Unable to send the report:"}};var o=function(e,t){for(var n in t)"strings"==n?o(e[n],t[n]):e[n]=t[n]};o(d.opt,e);var r=document.documentElement,m=document.body;d.iframe=null,d.submitted=!1,d.lastComment="",d.deobfuscate=function(e){return"!"==e.substr(0,1)&&(e=e.substr(1).replace(/(.)(.)/g,"$2$1")),e},d.run=function(){document.onkeypress=d.onkeypress},d.addOffScreen=function(e){return e.style.position="absolute",e.style.top="-10000px",m.lastChild?m.insertBefore(e,m.lastChild):m.appendChild(e),e},d.createIFrame=function(e){var t=document.createElement("DIV");return t.innerHTML='<iframe name="'+e+'"></iframe>',d.addOffScreen(t)},d.submit=function(e,t,n){var o="orphus_ifr";d.iframe=d.iframe||d.createIFrame(o);var r=document.createElement("FORM");r.action=d.opt.action,r.method="post",r.target=o;var i={version:d.opt.version,email:d.deobfuscate(d.opt.email),to:d.opt.strings.to,subject:d.opt.strings.subject,ref:e,c_pre:t.pre,c_sel:t.text,c_suf:t.suf,c_pos:t.pos,c_tag1:d.opt.c_tag1,c_tag2:d.opt.c_tag2,charset:document.charset||document.characterSet||"",comment:n};for(var o in i){var s=document.createElement("INPUT");s.type="hidden",s.name=o,s.value=i[o],r.appendChild(s)}d.addOffScreen(r),r.submit(),r.parentNode.removeChild(r)},d.windowInfo=function(){var e=0,t=0;"number"==typeof window.innerWidth?(e=window.innerWidth,t=window.innerHeight):r&&(r.clientWidth||r.clientHeight)?(e=r.clientWidth,t=r.clientHeight):m&&(m.clientWidth||m.clientHeight)&&(e=m.clientWidth,t=m.clientHeight);var n=0,o=0;return"number"==typeof window.pageYOffset?(o=window.pageYOffset,n=window.pageXOffset):m&&(m.scrollLeft||m.scrollTop)?(o=m.scrollTop,n=m.scrollLeft):r&&(r.scrollLeft||r.scrollTop)&&(o=r.scrollTop,n=r.scrollLeft),{width:e,height:t,scrollLeft:n,scrollTop:o}},d.showFor=function(e,i){if(!d.submitted){d.submitted=!0;var s=document.createElement("DIV"),t=Math.min(d.opt.maxWidth,m.clientWidth);s.innerHTML='<div id="orphusp" style="width: '+t+'px"><a class="logo" href="'+d.opt.homepage+'" target="_blank">Orphus</a><div class="legend">'+d.opt.strings.intextmsg+'</div><div class="fragment">'+e.replace(d.opt.c_tag1,"<mark>").replace(d.opt.c_tag2,"</mark>")+'</div><div class="hint">'+d.opt.strings.ifsendmsg.replace(/\r?\n/,"<br>")+'</div><form><div class="comment">'+d.opt.strings.entercmnt+'</div><input type="text" maxlength="250"><div class="buttons"><input type="submit" value="'+d.opt.strings.send+'">&nbsp;<input type="button" value="'+d.opt.strings.cancel+'"></div></form></div>',d.addOffScreen(s);var a=s.getElementsByTagName("input"),c=s.getElementsByTagName("form"),l=a[0],u=null,p=function(){document.onkeydown=u,u=null,s.parentNode.removeChild(s),d.submitted=!1,d.lastComment=l.value};setTimeout(function(){var e=s.clientWidth,t=s.clientHeight,n=d.windowInfo(),o=(n.width-e)/2+n.scrollLeft,r=(n.height-t)/2+n.scrollTop;s.style.left=o+"px",s.style.top=r+"px",l.value=d.lastComment,l.focus(),l.select(),u=document.onkeydown,document.onkeydown=function(e){27==(e=e||window.event).keyCode&&p()},c[0].onsubmit=function(){try{i(l.value)}catch(e){alert(d.opt.strings.submitex+"\n\n"+e)}return p(),d.lastComment="",!1},a[2].onclick=p},10)}},d.cleanString=function(e){return(""+e).replace(/[\r\n]+/g," ").replace(/^\s+|\s+$/g,"")},d.getSelection=function(){var e=null;if(null==(e=window.getSelection?window.getSelection():document.getSelection?document.getSelection():document.selection))throw"null getSelection()";var t,n="",o=null,r="";if(e.getRangeAt){if(!e.rangeCount)return;o=(i=e.getRangeAt(0)).toString(),(s=document.createRange()).setStartBefore(i.startContainer.ownerDocument.body),s.setEnd(i.startContainer,i.startOffset),n=s.toString(),(s=i.cloneRange()).setStart(i.endContainer,i.endOffset),s.setEndAfter(i.endContainer.ownerDocument.body),r=s.toString()}else if(e.createRange){var i,s;o=(i=e.createRange()).text,(s=e.createRange()).moveStart("character",-d.opt.contextLength),s.moveEnd("character",-o.length),n=s.text,(s=e.createRange()).moveEnd("character",d.opt.contextLength),s.moveStart("character",o.length),r=s.text}else o=""+e;var a=(t=o.match(/^(\s*)/))&&t[0].length,c=(t=o.match(/(\s*)$/))&&t[0].length;if(n+=o.substring(0,a),r=o.substring(o.length-c,o.length)+r,""!=(o=o.substring(a,o.length-c)))return{pre:n,text:o,suf:r,pos:-1}},d.show=function(){try{var t=d.getSelection()}catch(e){return void alert(d.opt.strings.badbrowser)}if(t){t.pre=t.pre.substring(t.pre.length-d.opt.contextLength,t.pre.length).replace(/^\S{1,10}\s+/,""),t.suf=t.suf.substring(0,d.opt.contextLength).replace(/\s+\S{1,10}$/,"");var e=d.cleanString(t.pre+d.opt.c_tag1+t.text+d.opt.c_tag2+t.suf);e.length>d.opt.maxSelection?alert(d.opt.strings.toobig):d.showFor(e,function(e){d.submit(document.location.href,t,e)})}else{var n=[d.opt.strings.name+" v"+d.opt.version,d.opt.strings.author,"",d.opt.strings.alt,"",d.opt.strings.gohome];confirm(n.join("\n"))&&window.open(d.opt.homepage,"_blank")}},d.onkeypress=function(e){var t=!1,n=window.event;if(n?t=10==n.keyCode||13==n.keyCode&&n.ctrlKey:e&&(t=10==e.which&&2==e.modifiers||0==e.keyCode&&106==e.charCode&&e.ctrlKey||13==e.keyCode&&e.ctrlKey),t)return d.show(),!1},d.run()}();